(function(v,E,T,a,P,k,u,d,q,M,J,Y,I,p){"use strict";function x(e,i,t,n,l,s,c){try{var o=e[s](c),g=o.value}catch(w){t(w);return}o.done?i(g):Promise.resolve(g).then(n,l)}function f(e){return function(){var i=this,t=arguments;return new Promise(function(n,l){var s=e.apply(i,t);function c(g){x(s,n,l,c,o,"next",g)}function o(g){x(s,n,l,c,o,"throw",g)}c(void 0)})}}var X="https://deeplx.mingming.dev/translate",Q=function(){var e=f(function*(i,t="auto",n,l=!1){try{if(l)return{source_lang:t,text:i};var s=yield(yield fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:i,source_lang:t,target_lang:n})})).json();if(s.code!==200)throw Error(`Failed to translate text from DeepL: ${s.message}`);return{source_lang:t,text:s.data}}catch(c){throw Error(`Failed to fetch from DeepL: ${c}`)}});return function(i){return e.apply(this,arguments)}}(),F={translate:Q},W=function(){var e=f(function*(i,t="auto",n,l=!1){try{if(l)return{source_lang:t,text:i};var s="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:t,tl:n,dt:"t",dj:"1",source:"input",q:i}),c=yield(yield fetch(s)).json();return{source_lang:t,text:c.sentences.map(o=>o.trans).join("")}}catch(o){throw Error(`Failed to fetch from Google Translate: ${o}`)}});return function(i){return e.apply(this,arguments)}}(),O={translate:W},U=T.findByProps("openLazy","hideActionSheet"),G=T.findByProps("ActionSheetRow")?.ActionSheetRow??d.Forms.FormRow,Z=T.findByStoreName("MessageStore"),ee=T.findByStoreName("ChannelStore"),ae=`
`,te=a.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:k.semanticColors.INTERACTIVE_NORMAL}}),S=[],ne=()=>P.before("openLazy",U,([e,i,t])=>{var n=t?.message;i!=="MessageLongPressActionSheet"||!n||e.then(l=>{var s=P.after("default",l,(c,o)=>{a.React.useEffect(()=>()=>{s()},[]);var g=q.findInReactTree(o,m=>m?.[0]?.type?.name==="ActionSheetRow");if(g){var w=Math.max(g.findIndex(m=>m.props.message===a.i18n.Messages.MARK_UNREAD),0),h=Z.getMessage(n.channel_id,n.id);if(!(!h?.content&&!n.content)){var N=h?.id??n.id,K=h?.content??n.content,C=S.find(m=>Object.keys(m)[0]===N,"cache object"),B=C?"\u8FD8\u539F":"\u7FFB\u8BD1",V=B==="\u7FFB\u8BD1"?u.getAssetIDByName("LanguageIcon"):u.getAssetIDByName("ic_highlight"),fe=function(){var m=f(function*(){U.hideActionSheet();try{var L=r.target_lang,b=B==="\u7FFB\u8BD1",Se=r.immersive_enabled;if(!h)return;var _;switch(r.translator){case 0:console.log("Translating with DeepL: ",h.content),_=yield F.translate(h.content,void 0,L,!b);break;case 1:console.log("Translating with GTranslate: ",h.content),_=yield O.translate(h.content,void 0,L,!b);break}var Re=b?Se?`${K}${ae}${_.text} \`[${L?.toLowerCase()}]\``:`${_.text} \`[${L?.toLowerCase()}]\``:C[N];a.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{id:N,channel_id:h.channel_id,guild_id:ee.getChannel(h.channel_id)?.guild_id,content:Re},log_edit:!1,otherPluginBypass:!0}),b?S.unshift({[N]:K}):S=S.filter(D=>D!==C,"cached data override")}catch(D){p.showToast("Failed to translate message. Please check Debug Logs for more info.",u.getAssetIDByName("Small")),M.logger.error(D)}});return function(){return m.apply(this,arguments)}}();g.splice(w,0,a.React.createElement(G,{label:`${B}`,icon:a.React.createElement(G.Icon,{source:V,IconComponent:()=>a.React.createElement(a.ReactNative.Image,{resizeMode:"cover",style:te.iconComponent,source:V})}),onPress:fe}))}}})})}),re=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),H=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),ie=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),j={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},se={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},le=T.findByProps("sendBotMessage"),oe=Object.entries(j).map(([e,i])=>({name:e,displayName:e,value:i})),ue=()=>J.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:ie.CHAT,inputType:re.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:H.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:H.STRING,choices:[...oe],required:!0}],execute(e,i){return f(function*(){var[t,n]=e;try{var l;switch(r.translator){case 0:l=yield F.translate(t.value,void 0,n.value);break;case 1:l=yield O.translate(t.value,void 0,n.value);break}return yield new Promise(s=>Y.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(d.Codeblock,null,l.text),confirmText:"Yep, send it!",onConfirm:()=>s({content:l.text}),cancelText:"Nope, don't send it"}))}catch(s){return M.logger.error(s),le.sendBotMessage(i.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}})()}}),{FormRow:R}=d.Forms,{ScrollView:$}=a.ReactNative,ce=()=>{I.useProxy(r);var[e,i]=a.React.useState("");return r.translator==0?a.React.createElement($,{style:{flex:1}},a.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{i(t)}}),Object.entries(j).filter(([t,n])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,n])=>a.React.createElement(R,{label:t,trailing:()=>a.React.createElement(R.Arrow,null),onPress:()=>{r.target_lang!=n&&(r.target_lang=n,p.showToast(`Saved ToLang to ${t}`,u.getAssetIDByName("check")))}}))):a.React.createElement($,{style:{flex:1}},a.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{i(t)}}),Object.entries(se).filter(([t,n])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,n])=>a.React.createElement(R,{label:t,trailing:()=>a.React.createElement(R.Arrow,null),onPress:()=>{r.target_lang!=n&&(r.target_lang=n,p.showToast(`Saved ToLang to ${t}`,u.getAssetIDByName("check")))}})))},{FormRow:A}=d.Forms,{ScrollView:ge}=a.ReactNative,he=()=>(I.useProxy(r),a.React.createElement(ge,{style:{flex:1}},a.React.createElement(A,{label:"DeepL",trailing:()=>a.React.createElement(A.Arrow,null),onPress:()=>{r.translator!=0&&(r.translator=0,p.showToast("Saved Translator to DeepL",u.getAssetIDByName("check")))}}),a.React.createElement(A,{label:"Google Translate",trailing:()=>a.React.createElement(A.Arrow,null),onPress:()=>{r.translator!=1&&(r.translator=1,p.showToast("Saved Translator to Google Translate",u.getAssetIDByName("check")))}}))),{ScrollView:de,Text:ye}=a.ReactNative,{FormRow:y,FormSwitch:me}=d.Forms,Te=a.stylesheet.createThemedStyleSheet({subheaderText:{color:k.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:a.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),pe=()=>{var e=a.NavigationNative.useNavigation();return I.useProxy(r),a.React.createElement(de,null,a.React.createElement(me,{label:"\u6C89\u6D78\u5F0F\u7FFB\u8BD1",subLabel:"\u5F00\u542F\u540E\u5C06\u540C\u65F6\u663E\u793A\u539F\u6587\u548C\u8BD1\u6587",leading:a.React.createElement(y.Icon,{source:u.getAssetIDByName("ic_chat_bubble_filled_24px")}),value:r.immersive_enabled??!0,onValueChange:i=>{r.immersive_enabled=i}}),a.React.createElement(y,{label:"Translate to",subLabel:r.target_lang?.toLowerCase(),leading:a.React.createElement(y.Icon,{source:u.getAssetIDByName("ic_activity_24px")}),trailing:()=>a.React.createElement(y.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translate to",render:ce})}),a.React.createElement(y,{label:"Translator",subLabel:r.translator?"Google Translate":"DeepL",leading:a.React.createElement(y.Icon,{source:u.getAssetIDByName("ic_locale_24px")}),trailing:()=>a.React.createElement(y.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translator",render:he})}),a.React.createElement(ye,{style:Te.subheaderText,onPress:()=>a.url.openURL("https://github.com/Rico040/bunny-plugins")},`Build: (${E.manifest.hash.substring(0,7)})`))},r=E.storage;r.target_lang??="en",r.translator??=1,r.immersive_enabled??=!0;var z=[],ve={onLoad:()=>z=[ne(),ue()],onUnload:()=>{for(var e of z)e()},settings:pe};return v.default=ve,v.settings=r,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
